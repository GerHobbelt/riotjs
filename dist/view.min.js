(function(riot){var BOOL_ATTR=/checked|selected|disabled|readonly|multiple/i,FALSE_VAL=/0|false|undefined|null/;function each(nodes,fn){Array.prototype.forEach.call(nodes,fn)}function walk(vdom,dom,fn){fn(vdom,dom);vdom=vdom.firstChild;dom=dom.firstChild;while(vdom){walk(vdom,dom,fn);dom=dom.nextSibling;vdom=vdom.nextSibling}}function syncAttr(from,to){each(from.attributes,function(attr){var name=attr.name,val=attr.value,to_attr=to.attributes[name];if(!to_attr||to_attr.value!=val){if(FALSE_VAL.test(val)&&BOOL_ATTR.test(name)){if(to_attr)to.removeAttribute(name)}else{to.setAttribute(name,val)}}})}function syncDOM(vdom,dom){if(vdom.nodeType==1){if(vdom.getAttribute("skip")!=null)return;syncAttr(vdom,dom)}else{var txt=vdom.textContent;if(txt!=dom.textContent)dom.textContent=txt}}function parseVDOM(html){var tmp=document.implementation.createHTMLDocument();tmp.body.innerHTML=html;return tmp.body.children[0]}function addMethod(attr,instance,domNode){var value=attr.value,i=value.indexOf("{"),method_name=value.slice(i+1,value.indexOf("}")).replace("()","").trim(),method=instance[method_name];if(method){domNode[attr.name]=function(e){method.call(this,e);instance.update()}}}function pushExpr(arr,value,node,attr){if(value.indexOf("{")!=-1){arr.push({expr:value,node:node,attr:attr&&attr.name})}}function toClassNames(expr,data){var colon=expr.indexOf(":"),qmark=expr.indexOf("?"),ret="";if(colon>0&&(qmark==-1||colon<qmark)){each(expr.split(","),function(keyval){keyval=keyval.split(":");var key=keyval[0].trim(),val=keyval[1].trim(),prop=data[val];if(typeof prop=="function"?prop():prop)ret+=key+" "});return ret.trim()}}function tmpl(str,data){var fn=new Function("data","return '"+str.replace(/{([^}]+)}/g,function(e,expr){var classes=toClassNames(expr,data);if(classes!==undefined)return classes;return"' + ("+(" "+expr).replace(/\s([a-z_])/gi," data.$1")+") + '"})+"'");return fn(data)}riot.view=function(root,template,instance,parent){var vdom=parseVDOM(template),dom=vdom.cloneNode(true),expressions=[];walk(vdom,dom,function(vdom,dom){if(vdom.nodeType==1){each(vdom.attributes,function(attr,i){if(attr&&attr.name.slice(0,2)=="on"){addMethod(attr,instance,dom)}else{pushExpr(expressions,attr.value,vdom,attr)}})}else{pushExpr(expressions,vdom.textContent,vdom)}});if(typeof root=="string")root=parent.root.querySelector(root);root.appendChild(dom);instance.update=function(){each(expressions,function(el){var node=el.node,value=tmpl(el.expr,instance);if(el.attr){node.setAttribute(el.attr,value)}else{node.textContent=value}});walk(vdom,dom,syncDOM);parent&&parent.update()};instance.update();return root}})(window.riot);